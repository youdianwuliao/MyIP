import{u as F,c as T,r as f,e as l,f as e,t as n,h as a,n as v,x as M,G as V,H as z,q as w,F as N,l as H,m as $,p as G,V as K,b as i,j as x}from"./vendor-CvqS6pG7.js";import{_ as J,u as Q,t as U,g as W}from"./index-BxdBlEeC.js";const X={class:"mtr-test-section my-4"},Y={class:"text-secondary"},Z={class:"row"},ee={class:"col-12 mb-3"},se={class:"card-body"},te={class:"col-12 col-md-auto"},oe={for:"queryURL",class:"col-form-label"},ne={class:"input-group mb-2 mt-2"},re=["disabled","placeholder"],ce=["disabled"],ae={key:0},le={key:1,class:"spinner-grow spinner-grow-sm","aria-hidden":"true"},ie={class:"jn-placeholder"},ue={key:0,class:"text-danger"},de={key:0,id:"censorshipresult",class:"row"},he={class:"col-md-6 col-12"},pe={class:"fs-4 alert alert-info"},ve={class:"table-responsive text-nowrap"},ye={scope:"col"},_e={scope:"col"},fe={scope:"col"},ke={scope:"col"},me={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},be={class:"col-md-6 col-12"},ge={class:"fs-4 alert alert-success"},Ce={class:"table-responsive text-nowrap"},we={scope:"col"},xe={scope:"col"},Re={scope:"col"},Te={scope:"col"},Ee={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},Se={key:0},Le=["data-bs-theme"],Ne={key:0},He={key:1},Ue={key:0},je={key:1},De={class:"opacity-75 fst-italic"},Oe={__name:"CensorshipCheck",setup(qe){const{t:r}=F(),R=Q(),b=T(()=>R.isDarkMode);T(()=>R.isMobile);const j=T(()=>R.lang),k=["CN","RU","TR","SA"],d=f([]),h=f("idle"),m=f(!1),g=f(!1),y=f([]),C=f(""),_=f(""),E=t=>{t.match(/^https?:\/\//)||(t="http://"+t);try{const s=new URL(t).hostname;if(s.match(/^[a-z0-9-]+(\.[a-z0-9-]+)*\.[a-z]{2,}$/i))return s}catch{}return _.value=r("censorshipcheck.invalidURL"),null},S=()=>{U("Section","StartClick","CensorshipCheck"),_.value="",d.value=[],h.value="idle",m.value=!1,g.value=!1,y.value=[],E(C.value)&&D()},D=()=>{U("Section","StartClick","CensorshipCheck");const t=E(C.value);if(!t)return;let o=0;const s=async()=>{h.value="running";try{const u=await fetch("https://api.globalping.io/v1/measurements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locations:[{country:"CN",limit:2},{country:"RU",limit:2},{country:"TR",limit:2},{country:"SA",limit:2},{country:"JP"},{country:"US"},{country:"CA"},{country:"IT"},{country:"FI"},{country:"AU"},{country:"FR"},{country:"DE"}],target:t,type:"http",measurementOptions:{request:{host:t,path:"/",method:"HEAD"},port:443,protocol:"HTTPS"}})});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return await u.json()}catch(u){console.error("Error sending HTTP request:",u),h.value="error",_.value=r("censorshipcheck.invalidURL")}},c=async u=>{try{const p=await fetch(`https://api.globalping.io/v1/measurements/${u}`);if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const L=await p.json();O(L),L.status==="in-progress"&&o<5?(setTimeout(()=>c(u),3e3),o++):d.value.length===0?(h.value="error",_.value=r("censorshipcheck.fetchError")):(q(),B(d.value),h.value="finished")}catch(p){console.error("Error fetching HTTP results:",p),h.value="error",_.value=r("censorshipcheck.fetchError")}};s().then(u=>{u&&u.id&&setTimeout(()=>{c(u.id)},3e3)})},O=t=>{const o=t.results.filter(s=>s.result.status==="finished"||s.result.status==="failed"||s.result.status==="in-progress").filter(s=>s.result.rawOutput!==null).map(s=>({country:s.probe.country,country_name:W(s.probe.country,j.value),city:s.probe.city,network:s.probe.network,status:s.result.status,headers:s.result.rawHeaders?"OK":""}));d.value=o},q=()=>{d.value.forEach(t=>{t.status==="in-progress"&&(t.status="failed")}),d.value=[...d.value.sort((t,o)=>{const s=k.indexOf(t.country),c=k.indexOf(o.country);return s!==-1&&c!==-1?s-c:s!==-1?-1:c!==-1?1:t.country.localeCompare(o.country)})]},B=t=>{y.value=[],k.forEach(c=>{t.filter(p=>p.country===c).every(p=>p.status==="failed"&&p.headers==="")&&y.value.push(c)});const o=t.filter(c=>!k.includes(c.country));o.filter(c=>c.status==="failed"&&c.headers==="").length>o.length/2?(y.value=[],m.value=!1,g.value=!0):m.value=y.value.length>0,y.value=y.value},P=t=>{t.style.height="0"},I=(t,o)=>{t.classList.add("collapsing"),t.style.height="fit-content",t.addEventListener("transitionend",o)},A=(t,o)=>{t.style.height="0",t.addEventListener("transitionend",o)};return(t,o)=>(i(),l("div",X,[e("div",Y,[e("p",null,n(a(r)("censorshipcheck.Note")),1)]),e("div",Z,[e("div",ee,[e("div",{class:v(["card jn-card",{"dark-mode dark-mode-border":b.value}])},[e("div",se,[e("div",te,[e("label",oe,n(a(r)("censorshipcheck.Note2")),1)]),e("div",ne,[M(e("input",{type:"text",class:v(["form-control",{"dark-mode":b.value}]),disabled:h.value==="running",placeholder:a(r)("censorshipcheck.Placeholder"),"onUpdate:modelValue":o[0]||(o[0]=s=>C.value=s),onKeyup:z(S,["enter"]),name:"queryURL",id:"queryURL","data-1p-ignore":""},null,42,re),[[V,C.value]]),e("button",{class:"btn btn-primary",onClick:S,disabled:h.value==="running"||!C.value},[h.value!=="running"?(i(),l("span",ae,n(a(r)("censorshipcheck.Run")),1)):(i(),l("span",le))],8,ce)]),e("div",ie,[_.value?(i(),l("p",ue,n(_.value),1)):w("",!0)]),d.value.length>0?(i(),l("div",de,[e("div",he,[e("h3",pe,n(a(r)("censorshipcheck.TestGroup")),1),e("div",ve,[e("table",{class:v(["table table-hover",{"table-dark":b.value}])},[e("thead",null,[e("tr",null,[e("th",ye,n(a(r)("censorshipcheck.Country")),1),e("th",_e,n(a(r)("censorshipcheck.Status")),1),e("th",fe,n(a(r)("censorshipcheck.City")),1),e("th",ke,n(a(r)("censorshipcheck.Network")),1)])]),e("tbody",null,[(i(!0),l(N,null,H(d.value.filter(s=>k.includes(s.country)),(s,c)=>(i(),l("tr",{key:s.country+"-"+s.city+"-"+c},[e("td",null,[e("span",{class:v("jn-fl fi fi-"+s.country.toLowerCase())},null,2),x(" "+n(s.country_name),1)]),e("td",null,[e("i",{class:v(["bi",{"bi-x-circle-fill text-danger":s.status==="failed","bi-check-circle-fill text-success":s.status==="finished"}])},null,2),s.status==="in-progress"?(i(),l("span",me)):w("",!0)]),e("td",null,n(s.city),1),e("td",null,n(s.network),1)]))),128))])],2)])]),e("div",be,[e("h3",ge,n(a(r)("censorshipcheck.ControlGroup")),1),e("div",Ce,[e("table",{class:v(["table table-hover",{"table-dark":b.value}])},[e("thead",null,[e("tr",null,[e("th",we,n(a(r)("censorshipcheck.Country")),1),e("th",xe,n(a(r)("censorshipcheck.Status")),1),e("th",Re,n(a(r)("censorshipcheck.City")),1),e("th",Te,n(a(r)("censorshipcheck.Network")),1)])]),e("tbody",null,[(i(!0),l(N,null,H(d.value.filter(s=>!k.includes(s.country)),(s,c)=>(i(),l("tr",{key:s.country+"-"+s.city+"-"+c},[e("td",null,[e("span",{class:v("jn-fl fi fi-"+s.country.toLowerCase())},null,2),x(" "+n(s.country_name),1)]),e("td",null,[e("i",{class:v(["bi",{"bi-x-circle-fill text-danger":s.status==="failed","bi-check-circle-fill text-success":s.status==="finished"}])},null,2),s.status==="in-progress"?(i(),l("span",Ee)):w("",!0)]),e("td",null,n(s.city),1),e("td",null,n(s.network),1)]))),128))])],2)])])])):w("",!0),$(K,{onBeforeEnter:P,onEnter:I,onLeave:A},{default:G(()=>[h.value==="finished"?(i(),l("div",Se,[e("div",{class:v(["alert",{"alert-info":g.value,"alert-danger":m.value,"alert-success":!m.value&&!g.value}]),"data-bs-theme":b.value?"dark":""},[m.value?(i(),l("span",Ne,[o[1]||(o[1]=e("i",{class:"bi bi-emoji-frown"},null,-1)),x(" "+n(a(r)("censorshipcheck.isBlocked")),1)])):(i(),l("span",He,[g.value?(i(),l("span",je,[o[3]||(o[3]=e("i",{class:"bi bi-emoji-expressionless"},null,-1)),x(" "+n(a(r)("censorshipcheck.isDown")),1)])):(i(),l("span",Ue,[o[2]||(o[2]=e("i",{class:"bi bi-emoji-smile"},null,-1)),x(" "+n(a(r)("censorshipcheck.notBlocked")),1)]))])),e("span",De,"( "+n(a(r)("censorshipcheck.Note3"))+" )",1)],10,Le)])):w("",!0)]),_:1})])],2)])])]))}},Ie=J(Oe,[["__scopeId","data-v-8b21ee0f"]]);export{Ie as default};

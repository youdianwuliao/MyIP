import{u as M,c as b,r as f,e as o,f as e,t as r,h as c,q as i,n as u,x as R,A as N,F as w,l as T,b as a,j}from"./vendor-CvqS6pG7.js";import{_ as E,u as A,t as O,g as D}from"./index-BxdBlEeC.js";const x={class:"mtr-test-section my-4"},B={class:"text-secondary"},U={key:0},V={class:"row"},q={class:"col-12 mb-3"},F={class:"card-body"},H={class:"row mt-3 mb-3 align-items-center justify-content-center"},$={class:"col-12 col-md-auto"},G={for:"mtrIP",class:"col-form-label"},J={class:"col-12 col-md-auto mt-2 mt-md-0"},L={class:"input-group"},z={disabled:"",value:""},K=["value"],W=["disabled"],Z={key:0},Q={key:1,class:"spinner-grow spinner-grow-sm","aria-hidden":"true"},X={key:0,id:"mtrresult"},Y=["data-bs-theme"],tt=["id"],et=["data-bs-target","aria-expanded","aria-controls"],st={key:0},ot=["id","aria-labelledby"],rt={class:"accordion-body"},at={key:1,id:"mtrresult-error"},nt=["data-bs-theme"],lt={__name:"MtrTest",setup(ct){const{t:d}=M(),v=A(),m=b(()=>v.isDarkMode),g=b(()=>v.isMobile),P=b(()=>v.lang);let S=b(()=>v.allIPs.filter(n=>n&&!n.includes(" ")));const y=f(""),_=f({}),l=f("idle"),C=()=>{O("Section","StartClick","MTRTest"),_.value=[];let p=0;const n=async()=>{l.value="running";try{const s=await fetch("https://api.globalping.io/v1/measurements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({limit:16,locations:[{country:"HK"},{country:"TW"},{country:"CN"},{country:"JP"},{country:"SG"},{country:"IN"},{country:"RU"},{country:"US"},{country:"CA"},{country:"AU"},{country:"GB"},{country:"DE"},{country:"FR"},{country:"BR"},{country:"ZA"},{country:"SA"}],target:y.value,type:"mtr",measurementOptions:{port:80,protocol:"ICMP"}})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(s){console.error("Error sending mtr request:",s)}},t=async s=>{try{const h=await fetch(`https://api.globalping.io/v1/measurements/${s}`);if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const k=await h.json();I(k),k.status==="in-progress"&&p<4?(setTimeout(()=>t(s),1e3),p++):_.value.length===0?l.value="error":l.value="finished"}catch(h){console.error("Error fetching mtr results:",h)}};n().then(s=>{s&&s.id&&setTimeout(()=>{t(s.id)},1e3)})},I=p=>{const n=p.results.filter(t=>t.result.status==="finished").filter(t=>t.result.rawOutput!==null).map(t=>({country:t.probe.country,country_name:D(t.probe.country,P.value),city:t.probe.city,network:t.probe.network,asn:t.probe.asn,rawOutput:t.result.rawOutput}));_.value=n};return(p,n)=>(a(),o("div",x,[e("div",B,[e("p",null,r(c(d)("mtrtest.Note")),1),g.value?i("",!0):(a(),o("p",U,r(c(d)("mtrtest.Note2")),1))]),e("div",V,[e("div",q,[e("div",{class:u(["card jn-card",{"dark-mode dark-mode-border":m.value}])},[e("div",F,[e("div",H,[e("div",$,[e("label",G,r(c(d)("mtrtest.Note3")),1)]),e("div",J,[e("div",L,[R(e("select",{id:"mtrIP","aria-label":"Select IP to MTR",class:u(["form-select jn-ping-form-select",{"bg-dark text-light":m.value}]),"onUpdate:modelValue":n[0]||(n[0]=t=>y.value=t)},[e("option",z,r(c(d)("mtrtest.SelectIP")),1),(a(!0),o(w,null,T(c(S),t=>(a(),o("option",{key:t,value:t},r(t),9,K))),128))],2),[[N,y.value]]),e("button",{class:"btn btn-primary",onClick:C,disabled:l.value==="running"||y.value===""},[l.value==="idle"||l.value==="finished"||l.value==="error"?(a(),o("span",Z,r(c(d)("mtrtest.Run")),1)):i("",!0),l.value==="running"?(a(),o("span",Q)):i("",!0)],8,W)])])]),_.value.length>0?(a(),o("div",X,[e("div",{class:"accordion",id:"mtrResults.valueAccordion","data-bs-theme":m.value?"dark":""},[(a(!0),o(w,null,T(_.value,(t,s)=>(a(),o("div",{class:"accordion-item",key:t.country},[e("h2",{class:"accordion-header",id:"heading"+s},[e("button",{class:u(["accordion-button",{collapsed:s!==0}]),type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse"+s,"aria-expanded":s===0?"true":"false","aria-controls":"collapse"+s},[e("span",{class:u("jn-fl fi fi-"+t.country.toLowerCase())},null,2),n[1]||(n[1]=j(" ")),e("strong",null,r(t.country_name)+", "+r(t.city),1),g.value?i("",!0):(a(),o("span",st," - "+r(t.network)+" ",1)),g.value?i("",!0):(a(),o("span",{key:1,class:u(["badge rounded-pill",m.value?"text-bg-warning":"text-bg-success"])},"AS"+r(t.asn),3))],10,et)],8,tt),e("div",{id:"collapse"+s,class:u(["accordion-collapse collapse",{show:s===0}]),"aria-labelledby":"heading"+s},[e("div",rt,[e("div",{class:u(["card card-body border-0 mt-3",[m.value?"bg-black text-light":"bg-light"]])},[e("pre",null,r(t.rawOutput),1)],2)])],10,ot)]))),128))],8,Y)])):i("",!0),l.value==="error"?(a(),o("div",at,[e("div",{class:"alert alert-info","data-bs-theme":m.value?"dark":""},r(c(d)("mtrtest.Error")),9,nt)])):i("",!0)])],2)])])]))}},dt=E(lt,[["__scopeId","data-v-9daf4453"]]);export{dt as default};
